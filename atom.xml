<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Just code it]]></title>
  <link href="http://billynyh.github.io//atom.xml" rel="self"/>
  <link href="http://billynyh.github.io//"/>
  <updated>2014-07-25T01:15:30+08:00</updated>
  <id>http://billynyh.github.io//</id>
  <author>
    <name><![CDATA[Billy Ng]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Y U NO public (or protected)]]></title>
    <link href="http://billynyh.github.io//blog/2014/07/20/yuno-public/"/>
    <updated>2014-07-20T20:47:27+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/07/20/yuno-public</id>
    <content type="html"><![CDATA[<p>Recently started a new project in work so I finally have a chance to use SwipeRefreshLayout. The integration is very simple and does not change the structure of ListView like <a href="https://github.com/chrisbanes/android-pulltorefresh">Android-PullToRefresh</a> (I still love that library), so it should be easier to perform custom logic on the ListView afterwards.</p>

<p>I also like the progress bar embeded in the view very much, and would like to use it in other components to make my apps&rsquo;s UI consistent. A quick look to the <a href="https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v4/java/android/support/v4/widget/SwipeRefreshLayout.java">source code</a> and found that it is implemented in the class <a href="https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v4/java/android/support/v4/widget/SwipeProgressBar.java">SwipeProgressBar</a>. It is sad that the class is not public and it seems there is no similar class in the framework and support library.</p>

<p>So, I just copy the code of SwipeProgressBar and BakedBezierInterpolator(required by SwipeProgressBar and also not public) myself and put it in my common lib, then use it in my app.</p>

<p>I understand that there are some kind of design principle of the class/methods visibility, but sometime it is quite frustrating that after going through the framework source code and found that you cannot to extend the class because some properties are private and does not have a public/protected getter.</p>

<p><img src="http://billynyh.github.io//images/posts/20140720/yuno.jpg" style="width:300px" /></p>

<h2>Reference</h2>

<ul>
<li><a href="http://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html">Controlling Access to Members of a Class</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ViewCompat.canScrollVertically()]]></title>
    <link href="http://billynyh.github.io//blog/2014/06/22/viewcompat-support-v4/"/>
    <updated>2014-06-22T19:56:29+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/06/22/viewcompat-support-v4</id>
    <content type="html"><![CDATA[<p>Due to watching world cup evey night through out the week, I spent most of my time these two weekends sleeping. Even not able to do some serious coding, I tried to clean up my long pending reading list, and I just took a look of <a href="http://developer.android.com/reference/android/support/v4/widget/SwipeRefreshLayout.html">SwipeRefreshLayout</a>.</p>

<p>Saw this class a while ago, just from the name of this class, I expected it to be a ViewGroup that handles the pull gesture of the Android style pull to refresh. I was not very interested in this class because there is no plan to touch the refresh UI in work, but it is always good to know it is in the support library.</p>

<p>What really caught my attention is the canChildScrollUp() method in SwipeRefreshLayout. It used ViewCompat.canScrollVertically and special handled pre-ICS.</p>

<p><a href="https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v4/java/android/support/v4/widget/SwipeRefreshLayout.java">Source line 348</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canChildScrollUp</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">mTarget</span> <span class="k">instanceof</span> <span class="n">AbsListView</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="kd">final</span> <span class="n">AbsListView</span> <span class="n">absListView</span> <span class="o">=</span> <span class="o">(</span><span class="n">AbsListView</span><span class="o">)</span> <span class="n">mTarget</span><span class="o">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">absListView</span><span class="o">.</span><span class="na">getChildCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>                    <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">absListView</span><span class="o">.</span><span class="na">getFirstVisiblePosition</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">absListView</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
</span><span class='line'>                            <span class="o">.</span><span class="na">getTop</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">absListView</span><span class="o">.</span><span class="na">getPaddingTop</span><span class="o">());</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">mTarget</span><span class="o">.</span><span class="na">getScrollY</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">ViewCompat</span><span class="o">.</span><span class="na">canScrollVertically</span><span class="o">(</span><span class="n">mTarget</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>(Well I don&rsquo;t understand why the ViewCompat method cannot(?) handle pre-ICS&hellip; then what&rsquo;s the point of Compat?)</p>

<p>I wasn&rsquo;t aware there is a canScrollVertically() method in View since ICS, and the ViewCompat also provides some interesting method that could simplify some custom ViewGroup implementation. Should put more time to review what&rsquo;s new in those commonly used classes as I believe there is no need to support pre-ICS soon.</p>

<p>Refrerence: <a href="http://antonioleiva.com/swiperefreshlayout/">http://antonioleiva.com/swiperefreshlayout/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Why I failed to have side projects]]></title>
    <link href="http://billynyh.github.io//blog/2014/06/01/failed-side-project/"/>
    <updated>2014-06-01T23:18:21+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/06/01/failed-side-project</id>
    <content type="html"><![CDATA[<p>At the beginning of last few years, I wrote down a list of things I want to do through out the year. I finished some, gave up some, and some stays on the list. One of the longest staying item is &ndash; &ldquo;start a side project&rdquo;.</p>

<h2>What takes me so long</h2>

<p>It is easy to come up with something, but it is even easier to ban the idea. At first I thought maybe it is easier to start when I get more experience, learned more tools, but the truth is, the more you see, the harder you start.</p>

<p>For example, I come up with an idea of building an Android app that provide list of XXX and allow user to do YYY on it. Sometime I would not even start when I find that it is not easy to get the XXX list, or after I wrote some scripts to crawl the list, I get distracted in other idea and put down the started project, sometime you just get tired in work and decided to take a break in weekend.</p>

<p>Obviously I am not determined enough. But another problem I found for myself is, I start losing that kind of fire I had 5 years ago.</p>

<h2>Excitement</h2>

<p>Two months ago, I helped in a workshop for my middle school about using <a href="http://appinventor.mit.edu/explore/">AppInventer</a> to build Android apps, targeting F1-F3 students (12-15yo). When I prepared the material, the first thing I found is that, not surprisingly, the tool has VERY limited features. I am not even sure what I can build using that, how do I give advise to those students?</p>

<p>During the workshop, before telling them what the tool can/cannot do, I let them students brainstorm the project topics, and told them not to worry if it is possible, we can &ldquo;fake&rdquo; it. Turned out they came up with some interesting idea, of course most are impossible to actually build it with their skill level (or even mine) and with that tool. But seeing their discussion reminded me a very important thing, <strong>the excitement</strong>.</p>

<h2>Don&rsquo;t think too much</h2>

<p>People have different reasons to start side projects, for me, it is simple, just to keep myself motivated and do things that I may not have chance to do in work.</p>

<h2>Related reading</h2>

<ul>
<li><a href="https://medium.com/busy-building-things/start-something-the-power-of-side-projects-648223f673af">Start Something: The Power of Side Projects</a></li>
<li><a href="https://medium.com/freelancers-life/side-projects-are-the-new-resume-a07e211240b2">Side projects are the new resume</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[F8 Mobile talks]]></title>
    <link href="http://billynyh.github.io//blog/2014/05/12/play-list/"/>
    <updated>2014-05-12T00:35:47+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/05/12/play-list</id>
    <content type="html"><![CDATA[<p>Got some days off last few weeks (public holiday and AL), spent quite lots of time on watching tech talks. (Another video summary post&hellip;)</p>

<h3><a href="https://www.youtube.com/watch?v=QErcmjPxEtg">Hacker Way: Designing the New Messenger</a></h3>

<p>The first one I watched was about designing Facebook messenger, a little bit slow, but talked about some design iterations and considerations through out the process which is quite interesting.</p>

<h3><a href="https://www.youtube.com/watch?v=mOyoTUETmSM">Hacker Way: Releasing and Optimizing Mobile Apps for the World</a></h3>

<div class="video-container">
<iframe src="http://www.youtube.com/embed/mOyoTUETmSM" frameborder="0" allowfullscreen></iframe>
</div>


<p>This one is really interesting. It talked about their Android app shipping schedule and workflow. The talk also included their buck system, heard this from other talks but this is the first time I heard (maybe I missed before) about the share build result over network, which is quite&hellip; crazy amazing.</p>

<h3><a href="https://www.youtube.com/watch?v=TCuVxU07NWs">Hacker Way: Mobile Engineering at Facebook&rsquo;s Scale</a></h3>

<div class="video-container">
<iframe src="http://www.youtube.com/embed/TCuVxU07NWs" frameborder="0" allowfullscreen></iframe>
</div>


<p>Similar contents but also worth watching.</p>

<h3><a href="http://www.infoq.com/presentations/Dagger">Dagger: A Fast Dependency Injector for Android and Java</a></h3>

<p>I have been researching the possibility of using dependency injection in current project. I think I will use it eventually, especially Facebook and Square are using it for a while. The biggest problem right now is it may affected every part of the app and I am not comfortable doing that without unit tests&hellip;</p>

<p>I also re-watched these two videos from IO 2013 as I am working on related view performance recently</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=vQZFaec9NpA">Google I/O 2013 &ndash; Android Graphics Performance</a></li>
<li><a href="https://www.youtube.com/watch?v=NYtB6mlu7vA">Google I/O 2013 &ndash; Writing Custom Views for Android</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Write dirty code]]></title>
    <link href="http://billynyh.github.io//blog/2014/05/06/dirty-code/"/>
    <updated>2014-05-06T22:55:49+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/05/06/dirty-code</id>
    <content type="html"><![CDATA[<h2>Huh?</h2>

<p>As an experienced software engineer, you are expected to write code reusable, modularized, clean, blah blah. Of course you do that in your product, but sometime you need dirty code to do dirty work, and I enjoy doing that. :)</p>

<h2>Code generator</h2>

<p>One of my favorite dirty code is code generator. When writing Java, sometime you need to write lots of getter setter, at first you just copy and paste, but after a few months, you will find the class goes big and messy, and it is easy to make mistakes, you may forget to change a variable, or put in wrong default value&hellip;</p>

<p>So, how about a little code generator? Make a config file containing the fields and data type, and just generate the java class for you. You don&rsquo;t even need to write the generator in Java, in my case, I have a python script that reads yaml config file and generates Java code.</p>

<p>That script is simple and ad hoc, you are not going to maintain that so when you want to &ldquo;reuse&rdquo; it, just copy the script, modify it, do whatever you want.</p>

<h2>Custom build scripts</h2>

<p>I have been using ant to build Android for a long time, just migrated to Gradle recently. One of the problem with the old system is lack of multiple build support. What I did in last 3 years is, have a custom ant task that modify the package name in AndroidManifest.xml and update all import of R in code.</p>

<p>And combine with code generator scripts, I can create builds with different config files which is one very important during development.</p>

<p>It is generally not a good idea to modify every .java files before compile, but with the limitation of the build system and you don&rsquo;t have the resources to dig deep, I would just use the dirty way (proudly).</p>

<h2>Get your hands dirty</h2>

<p>After working for some years, we switched our mind set from a programmer to an engineer, we may forget how to get dirty, forget how we used to &ldquo;hack&rdquo; things, forget how we rushed a course project in one night. By being a better engineer, we write better code, but we should not lose the ability of being dirty.</p>

<p>Use dirty code to do dirty work is just an example of use the right tool for the task.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Yes or No]]></title>
    <link href="http://billynyh.github.io//blog/2014/04/28/yes-or-no/"/>
    <updated>2014-04-28T00:34:33+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/04/28/yes-or-no</id>
    <content type="html"><![CDATA[<h2>From being interviewed to interview others</h2>

<p>I have been working as a developer in different startups, I am not a decision maker in any of it, but as I becoming a “senior engineer”, I start getting involved in the hiring process. And this gives me a good view to see even we all called ourselves &ldquo;startups&rdquo;, different teams can have very different hiring considerations.</p>

<h2>Limitation</h2>

<p>It is obvious that hiring in startups is very different from Google. You don&rsquo;t have a large pool of candidates for you to choose, you don&rsquo;t have a HR/recruitment team to do that for you, you can&rsquo;t simply fly someone from another country and give him a few rounds interview even you know it is a fit&hellip;</p>

<p>As I mentioned in previous post, Hong Kong is not a good place for tech people, it is normal that the best people leave Hong Kong for better opportunities. Of course there are still many good developers or potential candidates but it is hard for startups to reach those talents. For some companies/industries, they believed in some kind of &ldquo;hiring season&rdquo; indicating that the &ldquo;market&rdquo; is more active and can have better chance to find match for your openings. I agree on the probability, but in my opinion, it is easier for you to find a match, it is also easier for the candidates and they may turned down your offer after all.</p>

<h2>Decision</h2>

<p>No matter what are you looking for, what questions you asked, at the end of the day, as a interviewer, what your boss/manager want from you are actually just scores, comparison to other candidates and most importantly, YES or NO.</p>

<p>At first you may feel pressure of saying no because it means the candidate will not get the job, especially you don&rsquo;t have much comparisons at that time. But in my experience, the more you see, the easier you say no, the hard part is to say yes.</p>

<h2>What the YES means</h2>

<p>For me, a yes means</p>

<ol>
<li>If the new hires will be working with/under you, you feel comfortable to assign tasks to them and believe they are/will be able to handle it.</li>
<li>You want to work with them.</li>
</ol>


<p>(1) is the bottom line, no matter how experienced the candidate is, if you think they could have problem picking up the existing code base, it is usually a easy no. And when you are interviewing entry level developers, you may have a lower experience/technical bar but you still need to have a feeling that the candidate is a fast learner to give a yes.</p>

<p>(2) could be tricky, you may think he is qualified for the job on every aspect but you are still not sure about if you want to work with him, could be just impression, the way he talks, his background etc. For big companies, you may just say no if you are not sure, but for small teams, we try not to lose any potentially good candidates. So far I don’t have a good solution for this, most likely I will just tell my manager that I think he is qualified but I am not sure on personality, then let the next interviewer decide that.</p>

<h3>Conclusion</h3>

<p>Interview is not just about a company hiring a candidate, it is also about a candidate deciding to join a company. If you are a big company, you could think that it is the candidates lost to not joining you, but as a startup, things are not working that way, at least in Hong Kong. If you want to attract good people to join you, you need to show that you have what they looking for, or something better than what they are looking for. It&rsquo;s not always about money.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Talks from Facebook, Paper team]]></title>
    <link href="http://billynyh.github.io//blog/2014/04/21/talks-from-paper/"/>
    <updated>2014-04-21T21:10:00+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/04/21/talks-from-paper</id>
    <content type="html"><![CDATA[<p>During the long weekend of Easter holiday, I spent some time on watching tech talks from Facebook. The newly uploaded &ldquo;Building Paper 2014&rdquo; series is really cool. Even I don&rsquo;t do iOS, seeing how they tackle the problems and share their approach is totally enjoyable.</p>

<p>Android and iOS apps may have different platform structures, but when your app goes bigger, most likely you will need another level of abstraction to handle large amount of logic, UI and communication betweens components. And when you want further performance tuning, you may need to go beyond the platform like what Paper team did. At that stage, although you are using different languages, the architecture will be similar across platforms.</p>

<div class="video-container">
<iframe src="http://www.youtube.com/embed/ZdiBPHpxGd0" frameborder="0" allowfullscreen></iframe>
</div>


<p>I also like the part about <a href="https://www.youtube.com/watch?v=-KrF4bIofeo">contextually aware tutorials</a>, if you have time, you should watch the <a href="https://www.youtube.com/watch?v=OiY1cheLpmI">whole event</a>.</p>

<h2>UI details and A/B test</h2>

<p>Besides new talks, I also watched an old talk from &ldquo;Mobile Developer Day by Facebook + Parse 2013&rdquo;. Not sure why I skipped this talk before, probably because the title is so generic &ndash; <a href="https://www.youtube.com/watch?v=e2w8z6mI47U">Mobile at Facebook</a>. The part that caught my attention is the A/B testing on their drawer to nav bar changes. It&rsquo;s not about what framework they used, not about how many users they put in the AB test, it&rsquo;s about how you see the numbers.</p>

<p>She mentioned that after changing the drawer to nav bar, the result in internal test is good, navigation experience is improved, users feel the app faster. However, when they shipped to 1% test, they find that users liking and commenting less, because users are kind of distracted by the nav bar notification.</p>

<p>This is very interesting to me. We do not have a very detailed metrics system on mobile (have some, but not detailed), I am sure if we do AB test like that, we will not be able to see the abnormal usage changes. This even put me in a doubt that what if we already did changes like that and we still don&rsquo;t know that?</p>

<p>This is like a regression test, not on code but on usage.</p>

<div class="video-container">
<iframe src="http://www.youtube.com/embed/e2w8z6mI47U" frameborder="0" allowfullscreen></iframe>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android image decode bug on Samsung devices]]></title>
    <link href="http://billynyh.github.io//blog/2014/04/13/android-image-black-lines/"/>
    <updated>2014-04-13T23:21:18+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/04/13/android-image-black-lines</id>
    <content type="html"><![CDATA[<h2>Image decode bug on Samsung devices</h2>

<p>Few weeks ago I got some users reported about seeing &ldquo;black lines&rdquo; on the images. In 9GAG app, displaying images is everything so I can&rsquo;t just leave the problem unsolved.</p>

<p>At first I thought it is a problem I worked on before that when multiple download tasks running for the same image, may corrupt the file. However, this time is a little bit different.</p>

<p><img src="http://billynyh.github.io//images/posts/20140413/blacklines.png"/></p>

<p>I checked those reports and find that only users using (high end?) Samsung devices (S4 and Note3) hit this problem, and I cannot reproduce the problem on my testing devices. Luckily, we recently equipped a Samsung Galaxy S4 in office so I can schedule some time on this problem. And they are actually not black lines, they are transparent lines&hellip;</p>

<p>Even I suspected it is a manufacture specific problem, I did not expect I can reproduce the problem easily, so I am a little bit surprised to see the problem on the device. There are two possible causes of the problem, 1. the image file corrupted, 2. the image is correct but corrupted during decode to bitmap object. After a little test, I can confirm that I am dealing with (2)&hellip; When debugging with logcat, the following logs appear everytime the problem occurs.</p>

<pre><code>skia  D  JPEG content is corrupt, got a zero length row(272)
skia  D  JPEG content is corrupt, got a zero length row(273)
skia  D  JPEG content is corrupt, got a zero length row(274)
skia  D  JPEG content is corrupt, got a zero length row(275)
skia  D  JPEG content is corrupt, got a zero length row(276)
skia  D  JPEG content is corrupt, got a zero length row(277)
</code></pre>

<p>I thought once I have the error message, I am done, problem like this must be all over google and stackoverflow&hellip;</p>

<p>Nope, <a href="https://www.google.com/search?q=skia+JPEG+content+is+corrupt">not this time</a>.</p>

<p>There is not much I can do when there is only logs but no error message returned, I can&rsquo;t even detect the problem and reload the images. So I approach to tackle the problem is to reduce the chance of happening instead of fixing it. One observation is that, even this is not a step of reproduce, it usually/always comes with a dalvikvm heap grow. Follow on this direction and tuned a bit memory performance, somehow like harder to hit the problem. (magic?)</p>

<p>This is for sure not a &ldquo;fix&rdquo;, and &ldquo;looks harder to hit the problem&rdquo; could actually be luck, but that&rsquo;s all I can get in a few hour scheduled time.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Move fast and break things]]></title>
    <link href="http://billynyh.github.io//blog/2014/04/07/move-fast-break-things/"/>
    <updated>2014-04-07T21:45:34+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/04/07/move-fast-break-things</id>
    <content type="html"><![CDATA[<h2>Who said that</h2>

<p>Mark Zuckerberg <a href="http://www.wired.com/2012/02/zuck-letter">did</a>.</p>

<blockquote><p>Moving fast enables us to build more things and learn faster. However, as most companies grow, they slow down too much because they’re more afraid of making mistakes than they are of losing opportunities by moving too slowly. We have a saying: “Move fast and break things.” The idea is that if you never break anything, you’re probably not moving fast enough.</p></blockquote>


<p>I totally agree on the idea. However, like doing startups, the idea is important but what really matter is <strong>execution</strong>. How do you interpret &ldquo;move fast and break things&rdquo; affects the direction of the team. If you are in the wrong direction and move fast, there is no guarantee that you can go back to where you were even you &ldquo;move fast&rdquo; again.</p>

<h2>Be able to move fast</h2>

<p>Depends on the scale of your product, there should be different way to move fast. For new product or just a prototype, you should collect user feedbacks, move fast, break things, <strong>get on the right direction</strong> as soon as possible. That is the speed you needed to survive in the industry.</p>

<p>What&rsquo;s next? You have some users, using your app everyday, but not yet the giant scale. To get more users, you need to keep moving and this is another type of moving fast. This time, you cannot just move fast and break things like the time when you start. From development point of view, as the code complexity increase, unless you have a good infrastructure, you will find that it is getting harder and harder to add features on top of it. When you add one feature, you may introduce two bugs, and slowed the app down at the same time. Beside that, there is a cost when you break things, maybe get some bad rating, maybe pissed off some users.</p>

<p>This does not mean you should not move fast, but you have to <strong>do it smart</strong>. You have to be clear on what you want to achieve from moving fast. If you want to try out new interface and get user feedback, it does not need to be 100% polished, but don&rsquo;t rollout a 20% done ugly version, all you can get is bad rating instead of constructive feedback about the new features.</p>

<p>I agree on moving fast, but I also believe in &ldquo;<strong>less is more</strong>&rdquo; (slow is fast?). At the end of the day, it is all about what the users want, new features may boost your number a little bit, but sometimes quality is what makes the users come back and use your app and not switching to other competitors.</p>

<p>Instead of running on your foot, isn&rsquo;t it better to get a bike or a car if you want to move fast?</p>

<h2>When you break things</h2>

<p>Please, <strong>fix it</strong>, before you break another thing.</p>

<h2>Reference</h2>

<ul>
<li><a href="http://www.wired.com/2012/02/zuck-letter">Mark Zuckerberg’s Letter to Investors</a></li>
<li><a href="http://venturebeat.com/2012/06/26/facebook-hacker-stories/">Move fast, break things: Four stories for hackers from Facebook</a></li>
<li><a href="http://spectrum.ieee.org/at-work/innovation/facebook-philosophy-move-fast-and-break-things">Facebook Philosophy: Move Fast and Break Things</a></li>
<li><a href="http://mashable.com/2014/03/13/facebook-move-fast-break-things/">Are Facebook&rsquo;s &lsquo;Move Fast and Break Things&rsquo; Days Over?</a></li>
<li><a href="http://startupbitsnbobs.com/2014/04/04/move-fast-and-break-things/">Startup就是一窩老鼠</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Notes on migrating Android project from ant to gradle]]></title>
    <link href="http://billynyh.github.io//blog/2014/03/31/gradle-migration/"/>
    <updated>2014-03-31T00:44:28+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/03/31/gradle-migration</id>
    <content type="html"><![CDATA[<p>Few months ago, I spent a little time to try migrating my Android project from to gradle, although it is announced in last Google IO (May 2013), and saw some big companies switched to it early, I considered that not ready that time and decided to wait for later version.</p>

<h3>Projects structures</h3>

<p>The project I am working on used some library projects like pull to refresh, facebook sdk, google play services, etc, due to the limitation of the old ant build system, you have to include the source and compile with your app. We also splitted some of our own components to separate library projects for reuseing in other projects. Currently my app is depending on 14 other library projects, and it takes about 3 minutes to have do a clean build.</p>

<p>We also use git submodules to include projects from other repositories. I am still not sure if this is the right way to manage projects especially when we keep modifying the libraries. It increases the complexity when we have multiple branches in development, and causes some pains when merging codes.</p>

<h3>First migration attempt</h3>

<p>I tried to migrate to gradle few months ago, when Android studio was in version 0.2 I think. One of the unknown part of the migration, it&rsquo;s 0 or 100, no 50% migrated. Even you build every library successfully, it does not mean you are getting close to finish the migration. In my case, I first made a simple app to get familiar with the build system, then migrated my libraries one by one, but guess what I got when I tried to have a complete build? Out of memory&hellip; I googled a little bit and found a way to increase the memory limit but still got the same error, in both command line and Android studio.</p>

<p>I didn&rsquo;t put more time on that since the ant scripts still work at that time and I got (many) other tasks pending.</p>

<h3>Second attempt</h3>

<p>I recently reopened the migration task, mainly for 3 reasons.</p>

<ol>
<li>Eclipse can&rsquo;t handle the project anymore. When I tried to add some code in a core library project that is also used in 3 other library projects, eclipse just hangs there and I have to kill it myself.</li>
<li>Need more tools for development. Actually this is one of the reason of my first attempt of migration, I had some (simple) scripts/code generators to help development, some are standalone but some are hooked into the build flow. It does not make sense to keep developing scripts based on ant if there is a migration coming, so I didn&rsquo;t add any scripts in the last 6 months. In order to continue the development, the migration task now becomes a blocker.</li>
<li>Team expand. We are expecting more man power on Android, the migration has to be done before they start.</li>
</ol>


<p>Not like last time, this is no longer a &ldquo;try out&rdquo;, it has to be done, no matter how many effort required.</p>

<p>After reinstalling the Android studio and gradle, I still got the out of memory error during compile. At this point, even I can get through the compile task of each library, I may got other error when combining everything in the app project, so I have to do some experiments first. I compiled all library projects to aar and uploaded to local maven repositories, this also required me to modify the build.gradle of the app project to use aar instead of compile form source. With some luck, I can compile the app with those aar successfully.</p>

<p>Next step is to make it fits my development workflow. Some library projects need to compile from source and those relatively stable libraries can use aar. Fortunately it worked as expect and did not gave me out of memory error, and even better, it also worked on Android studio without any extra modification.</p>

<p>Migrating the basic workflow is just the beginning, there are still many things to test before using it to do release, like app signing, proguard, build with different package names, etc&hellip; But before those tasks, there is still one problem needed to work on. I am not sure it is just me, but the gradle configure time seems very long with multi projects setup, and it may not suppose to be that slow. I posted my question on <a href="https://plus.google.com/u/0/105980838674582844427/posts/8sYLTN6WyCt">Google plus</a> and got some quick responses from Xavier Ducrohet. He said the configure time should be around 3s if run with daemon, but what I got is at least 10s for every one, even a simple &ldquo;gradle projects&rdquo; command call. I am not sure if this is the best I can get but it would not be a great development experience if every run need to wait for 10s and the actual compile is just 2s.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The gatekeeper]]></title>
    <link href="http://billynyh.github.io//blog/2014/03/24/gatekeeper/"/>
    <updated>2014-03-24T23:11:56+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/03/24/gatekeeper</id>
    <content type="html"><![CDATA[<p>Recently read some articles from <a href="https://medium.com/the-year-of-the-looking-glass">Julie Zhuo&rsquo;s</a>, she is a Product design director in Facebook. Although her posts are not about engineering, I still feel connected with most of the topics. I wrote some of my thoughts originally, but I think just put the quotes here is enough.</p>

<p><a href="https://medium.com/the-year-of-the-looking-glass/5c48db173662">&ldquo;Don&rsquo;t be a gatekeeper&rdquo;</a></p>

<blockquote><p>If you are somebody with an incredible amount of passion for high quality, you may be compelled to become a gatekeeper at some point in your life.</p></blockquote>




<blockquote><p>If you are a gatekeeper or find yourself thinking we need a gatekeeper, the thing that is broken or missing is trust. So instead of judging yes or no, good or bad, consider this instead: what could I do to make it so that I have more trust in the people around me?</p></blockquote>


<p><a href="https://medium.com/the-year-of-the-looking-glass/d0aa3b8af9b7">&ldquo;Why Designers Leave&rdquo;</a></p>

<blockquote><p>Every person who works in a creative field has an aspiration for her work, a yearning for that ideal plane which is the culmination of her taste.</p><p>When an environment fails, over and over and over again, to provide her with a means to follow her internal compass, then she will leave.</p><p>If you are in a position to influence that kind of environment, take heed. Lay the foundations for a space that nurtures, that yields the kind of work the best creative people can be proud of.</p></blockquote>


<p><a href="https://medium.com/the-year-of-the-looking-glass/bcddf7c85553">&ldquo;Quality is not a tradeoff&rdquo;</a></p>

<blockquote><p>Quality is a bar, not a tradeoff.</p></blockquote>




<blockquote><p>It just doesn’t work like that.</p><p>Why? Because to create high-quality work, there has to be a minimum acceptable bar. And high-quality creators cannot trade off below that bar. They simply can’t.</p></blockquote>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Where Do You See Yourself in 5 Years - Why]]></title>
    <link href="http://billynyh.github.io//blog/2014/03/16/5yr-part-2-why/"/>
    <updated>2014-03-16T22:55:02+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/03/16/5yr-part-2-why</id>
    <content type="html"><![CDATA[<p>It may be better in these two years, but back in 2008, people always say Hong Kong is not a good place for tech, especially for web startup. I agree, the whole environment, atmosphere, values put the industry in a big disadvantage. For example, in Hong Kong, you can make better living by doing financial related jobs, and usually have a stabler career path compared to being a programmer.</p>

<p>There is no one to blame. It is normal that a city puts more focus on some area, and has lower priority on others. Yes, HK government sometimes mention IT is one of their important industry, but do you really think the government has what it takes to do anything to help local startup on this fast changing world? I am not judging the government policy/work, I just think it is not their business.</p>

<h2>Why stay in Hong Kong</h2>

<p>So, why don&rsquo;t just go? Before I started everything, I had a short internship in Shanghai. As I mentioned in previous post, I was totally not prepared before graduate, so this internship kind of affected how I see the industry and the live of being a developer outside Hong Kong. It was a mixed experience, I did not do well, I can&rsquo;t say I enjoyed it a lot, but I did open my eye and started thinking how should I go from that point.</p>

<p>I also had an interview in US, it was a no again. I believe I would just leave HK if I got the job and things would go in a completely different way, but I am still proud of what happened next. It sounds like I was stuck in Hong Kong with no choice, there is always choices, I could keep applying but why give up Hong Kong without a try? Even the industry was bad here, I need to know how bad is it.</p>

<h2>Why work in startups</h2>

<p>From my short internship experience, I learned that if you work in a big team, most likely you will be limited to the tech they already using, it is not a bad thing since you can get deep knowledge in that area, but I was not sure if it was good for me in that time. Touching different latest technologies in development is important to me, it shows how the developers around the world work and keeps you in the trend. You can always try out new stuff in your own time, but as newbie like me, I will need to spend my own time on catching up work. Therefore, working in a (new/small) startup that opens to different technologies would be a best fit to me.</p>

<p>In terms of earnings, working in startup would probably at the bottom of the list amount the jobs required similar skill level. Mathematically you can say you had the possibility of going big in a startup but 0 chance of not doing that. But if this is really the reason of doing startup, you are either very confident in yourself and your team, or you are not go at math&hellip;</p>

<p>There is no doubt that I want the startup I am working in goes big one day, but it is not the only thing I care. Besides the result, I value the process even higher. What working in startup means to me is, even you are in a small team and do not have many resources compare to big companies, you can still do something big. To do that, you need to optimize the time, tools, resource you have and keep challenge your team to improve.</p>

<h2>What&rsquo;s next</h2>

<p>After working in different startups for 5 years, I think I am still learning and improving as an engineer. I believe someday when I am more experienced and my skill reached certain level, I may have a different view of everything. I am looking forward for what will happen on me and the industry in the next 5 years.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Try out Quartz Composer and Origami]]></title>
    <link href="http://billynyh.github.io//blog/2014/03/09/quartz-composer-origami/"/>
    <updated>2014-03-09T19:59:11+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/03/09/quartz-composer-origami</id>
    <content type="html"><![CDATA[<p>In late Jan, I watched a <a href="https://www.youtube.com/watch/?v=s5kNm-DgyjY">talk &ndash; Bringing Beautiful Interactions to Android Apps</a> from Facebook about how they use Quartz Composer(QC) when developing Facebok Home (and chat head). Compare to other prototyping tools, QC can better illustrate animations and interactions. It is quite impressive and I actually installed QC the day after and tried to play on it. But when I first opened it, I was totally lost, not saying it is hard to use, but it is obvious that there is a learning curve on this tool. I did not spend more time on it that time but kept it in my TODO list.</p>

<div class="video-container">
<iframe src="http://www.youtube.com/embed/s5kNm-DgyjY" frameborder="0" allowfullscreen></iframe>
</div>


<p>Two weeks later, Facebook released <a href="http://facebook.github.io/origami/">Origami</a>, an extension of QC. Followed with some articles about how it is used in Facebook. Yesterday I gave it another try. This time I am more serious compared to last time. My target is at least understand (not fully) how it works and be able to do a simple demo to my team.</p>

<h2>Let&rsquo;s start</h2>

<p>This time I started with the <a href="https://developer.apple.com/library/mac/documentation/graphicsimaging/conceptual/quartzcomposeruserguide/qc_intro/qc_intro.html">documentation</a>, not saying it is poorly documented, but it is not much fun to read it(my bad)&hellip; Then I went for tutorials, after a quick look of some articles on QC (not Origami), I had little concept of patches (but missed macro patch&hellip;), then I think maybe I can understand the Origami examples.</p>

<p>When I opened the &ldquo;Photo Grid&rdquo; example, I only see three patches, I knew that there must be some hierarchy hidden from the interface, I tried to use the patch inspector to look around but have no idea where to go, I was stuck again. Then I found this <a href="http://vimeo.com/85578380">video</a> on Origami&rsquo;s twitter, which turned out was everything I needed.</p>

<div class="video-container">
<iframe src="http://player.vimeo.com/video/85578380" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> 
</div>


<pre><code>It is the visual version spaghetti code // 6:50
</code></pre>

<h2>Short notes</h2>

<ul>
<li>&ldquo;Phone&rdquo; patch is the basic component for the phone prototype, which displays an image in device frame.</li>
<li>Use &ldquo;Render in Image&rdquo; for the content to display.</li>
<li>Double click the &ldquo;Render in Image&rdquo; patch to edit the macro patch of it.</li>
<li>A &ldquo;Layer&rdquo; patch will be automatically added when you drag in an image.</li>
</ul>


<p><img src="http://billynyh.github.io//images/posts/20140309/qc-1.jpg"/></p></p>

<h2>Reference</h2>

<ul>
<li><a href="http://facebook.github.io/origami/">http://facebook.github.io/origami/</a></li>
<li><a href="https://medium.com/the-year-of-the-looking-glass/f1173d0bd181">Introducing Origami for Quartz Composer</a></li>
<li><a href="http://www.wired.com/wiredenterprise/2014/03/facebook-paper/">Facebook Paper Has Forever Changed the Way We Build Mobile Apps</a></li>
<li><a href="http://vimeo.com/85578380">Vimeo &ndash; Prototyping with Facebook Origami</a>

<ul>
<li>Asset for the example <a href="https://github.com/jaythrash/spy-book">https://github.com/jaythrash/spy-book</a></li>
</ul>
</li>
<li><a href="https://www.youtube.com/watch/?v=s5kNm-DgyjY">Youtube &ndash; Bringing Beautiful Interactions to Android Apps &ndash; Mobile @ Scale</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Where do you see yourself in 5 years - How I started]]></title>
    <link href="http://billynyh.github.io//blog/2014/03/08/5yr-part-1/"/>
    <updated>2014-03-08T22:41:19+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/03/08/5yr-part-1</id>
    <content type="html"><![CDATA[<h2>5 years ago</h2>

<p><strong>Where do you see yourself in 5 years</strong>. This was the very first question I got asked in an interview after graduated from university in 2008. I started as a web developer, also touched a little bit iOS. Then I decided to focus on Android and now I am a pure Android developer, nothing close to an expert, but I know what I can do and I am confident in my work.</p>

<p>Of course I did not picture me being Android developer 5 years ago, but other than that, I did foresee myself focused on one area instead of touching everything. Not saying that I am now Android only, but if there is one thing I have better knowledge compare to others in my team, it would be Android.</p>

<div style="background:#ccc; padding:20px">
<p style="text-align:center">
<img src="http://billynyh.github.io//images/posts/20140308/five-years.png"/></p>
<p style="text-align:right"><a href="http://xkcd.com/1088/">Source: xkcd</a></p>
</div>


<p>Back in 2008, I enjoyed my 3 years programming competition life and knew absolutely nothing about the real world. I wanted to be a software engineer but had no idea what its like before I graduated (I am not saying it is a bad thing, having work experience before graduate means very little to me, but you may feel a little bit lost at the beginning). I even didn&rsquo;t prepare for that interview, or you can say, that interview was my preparation of the next interview.</p>

<p>My first reaction on that 5yr question was like, I know nothing about your company, most likely I will not be there 5 years later, what should I say? Is it a trick question? As expected, I did not get the job but this question stays in my head through out the years.</p>

<p>After some friends&#8217; referral and meeting different people, I joined a new, small and passionate &ldquo;startup + software house&rdquo; team and started my developer life. I started as a web developer, learning all kind of web tech through client projects, first did some Wordpress theme, then some rails, python and mongodb. Doing projects with different languages and frameworks gave me a chance to play with latest tech outside and most importantly, pushed my learning skill.</p>

<h2>Android</h2>

<p>Around that time, iPhone was in a very good trend and we started to have some iOS projects. Even I participated in some, I was not a big fan of smart phone as I was already with my computer all day.</p>

<p>In 2010, I got my first smart phone, Google Nexus One, it did not magically changed how I see smart phone in a short time. I actually was still not so convinced by the idea of smart phone in the first few months. What happened was that, one day we decided to play with the Android sdk and build something we want (and simple). This was mainly for fun, and also to let us had a taste of Android development so we might take some Android project in the future.</p>

<p>We decided to make a camera app as side project, because we did see some good camera apps on iOS but those on Android were not compareable to them. Turned out it is nothing close to simple, or I should say, it was one of the hardest thing you can do within the computing power at that time. We spent one week to have our first prototype, everything was ugly, but we just put it on Android market right away. We did not know what to expect, but we were happy to see people actually enjoyed our app. Then I started maintaining the app in my own time and took that chance to catch up with the latest Android development. We learned a lot from building that app, it is a long story so I will not include it here.</p>

<h2>Leaving the comfort zone</h2>

<p>I stayed in my first company for 3 years. Although we did not go big or have any crazy viral product, we survived, which I think already is an achievement in Hong Kong. I enjoy being a (big) part of the team but I started thinking that 5 years question. I could basically see how I would be if nothing changed and I was not sure if it is what I want. There were other considerations but in short, I decided to leave my comfort zone. I quited my job in early 2012, took a little break and threw myself back to the market.</p>

<p>This time, I started as an Android developer.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A deeper look of ViewPager and FragmentStatePagerAdaper]]></title>
    <link href="http://billynyh.github.io//blog/2014/03/02/fragment-state-pager-adapter/"/>
    <updated>2014-03-02T21:01:40+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/03/02/fragment-state-pager-adapter</id>
    <content type="html"><![CDATA[<h2>Background</h2>

<p>Last week I was working on a remove action on ViewPager, so based on the knowledge from ListView&rsquo;s adapter, I tried removing the item and called notifyDataSetChanged, it didn&rsquo;t work. So I googled a little bit and found that I need to override the getItemPosition method in PagerAdapter when removing item.</p>

<p>This is the doc from PagerAdapter</p>

<blockquote><p>A data set change may involve pages being added, removed, or changing position. The ViewPager will keep the current page active provided the adapter implements the method getItemPosition(Object).</p></blockquote>

<p>and description of getItemPosition</p>

<blockquote><p>Called when the host view is attempting to determine if an item&rsquo;s position has changed. Returns POSITION_UNCHANGED if the position of the given item has not changed or POSITION_NONE if the item is no longer present in the adapter.</p></blockquote>

<p>Then I put it in my pager adapter, got a different behavior, but still not work correctly. Three thoughts came to me immediately:</p>

<ol>
<li>something wrong in my getItemPosition</li>
<li>something wrong when I integrate with my other code.</li>
<li>something wrong in FragmentStatePagerAdapter</li>
</ol>


<p>For 1, it is easy to verify by printing logs and it looked good to me. 2, I don&rsquo;t think so but still spend some time to check my code first. As expected, problem still existed. I always have a problem with Fragment lifecycle, everytime I thought I understand more, a new problem came out and breaks my understanding of fragment lifecycle. I tried hard to avoid go deep to the implementation of FragmentStatePagerAdapter, but this time I have no choice.</p>

<h2>FragmentStatePagerAdapter</h2>

<p>I am a little bit surprised by the <a href="https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v4/java/android/support/v4/app/FragmentStatePagerAdapter.java">short code length</a> of it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v4/java/android/support/v4/app/FragmentStatePagerAdapter.java</span>
</span><span class='line'><span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Fragment</span><span class="o">&gt;</span> <span class="n">mFragments</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Fragment</span><span class="o">&gt;();</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="n">Object</span> <span class="nf">instantiateItem</span><span class="o">(</span><span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">mFragments</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Fragment</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mFragments</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">f</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">f</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">mCurTransaction</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mCurTransaction</span> <span class="o">=</span> <span class="n">mFragmentManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Fragment</span> <span class="n">fragment</span> <span class="o">=</span> <span class="n">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>    <span class="n">mFragments</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">position</span><span class="o">,</span> <span class="n">fragment</span><span class="o">);</span>
</span><span class='line'>    <span class="n">mCurTransaction</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">container</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">fragment</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">fragment</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroyItem</span><span class="o">(</span><span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Fragment</span> <span class="n">fragment</span> <span class="o">=</span> <span class="o">(</span><span class="n">Fragment</span><span class="o">)</span><span class="n">object</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">mCurTransaction</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mCurTransaction</span> <span class="o">=</span> <span class="n">mFragmentManager</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>    <span class="n">mSavedState</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">position</span><span class="o">,</span> <span class="n">mFragmentManager</span><span class="o">.</span><span class="na">saveFragmentInstanceState</span><span class="o">(</span><span class="n">fragment</span><span class="o">));</span>
</span><span class='line'>    <span class="n">mFragments</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">position</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mCurTransaction</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">fragment</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is what FragmentStatePagerAdapter does in instantiateItem and destroyItem, in short, it maintains an ArrayList mFragments which mFragments.get(i) returns the fragment that is in position i, null if fragment not in fragment manager. By default, ViewPager will keep one item before and after current item, so if you are at position 1 (0-based), mFragments will be like</p>

<table>
<thead>
<tr>
<th> 0 </th>
<th> 1 </th>
<th> 2 </th>
<th> 3 </th>
<th> 4 </th>
</tr>
</thead>
<tbody>
<tr>
<td> F0 </td>
<td> F1 </td>
<td> F2 </td>
<td> null </td>
<td> null </td>
</tr>
</tbody>
</table>


<h2>Remove item</h2>

<p>What will happen if I remove F1 and call notifyDataSetChanged? the result of getItemPosition should be</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>F0: 0 (or POSITION_UNCHANGED?)
</span><span class='line'>F1: POSITION_NONE
</span><span class='line'>F2: 1</span></code></pre></td></tr></table></div></figure>


<p>Right?</p>

<p>Then I expect mFragments become</p>

<table>
<thead>
<tr>
<th> 0 </th>
<th> 1 </th>
<th> 2 </th>
<th> 3 </th>
<th> 4 </th>
</tr>
</thead>
<tbody>
<tr>
<td> F0 </td>
<td> F2 </td>
<td> null </td>
<td> null </td>
<td> null </td>
</tr>
</tbody>
</table>


<p>But from the source of FragmentStatePagerAdapter, I don&rsquo;t think it has any handling of it. I copied the source and added some log to dump mFragments out, and find that it is like</p>

<table>
<thead>
<tr>
<th align="left"> Step </th>
<th> What I see </th>
<th> 0 </th>
<th> 1 </th>
<th> 2 </th>
<th> 3 </th>
<th> 4 </th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"> 1 </td>
<td>curr item F1 </td>
<td> F0 </td>
<td> F1 </td>
<td> F2 </td>
<td> null </td>
<td> null </td>
</tr>
<tr>
<td align="left"> 2 </td>
<td>after remove F1, F2 becomes curr item </td>
<td> F0 </td>
<td> null </td>
<td>  F2 </td>
<td> null </td>
<td> null </td>
</tr>
<tr>
<td align="left"> 3 </td>
<td>swipe next, no item displayed but F4 instantiated </td>
<td> null </td>
<td> null </td>
<td> F2 </td>
<td> F4 </td>
<td> null </td>
</tr>
<tr>
<td align="left"> 4 </td>
<td>swipe next, curr item F4 </td>
<td> null </td>
<td> null </td>
<td> F2 </td>
<td> F4 </td>
<td> F5 </td>
</tr>
<tr>
<td align="left"> 5 </td>
<td>swipe next, curr item F5 </td>
<td> null </td>
<td> null </td>
<td> null </td>
<td> F4 </td>
<td> F5 </td>
</tr>
</tbody>
</table>


<p>then the app crashed on step 5 when it tries to destroy F2.</p>

<h2>Dafaq?</h2>

<p>First of all, what happened in step 2? It just removed F1 and left F2 there, and ViewPager just display it?</p>

<p>Yes, something like that.</p>

<ol>
<li>When F1 is removed and called notifyDataSetChanged, ViewPager will call getItemPosition for each item, in the order of F0, F1, F2.</li>
<li>When POSITION_NONE is returned for F1, adapter&rsquo;s destroyItem is called and F1 is removed from FragmentManager and mFragments.</li>
<li>Then for F2, it returned the new position 1, which match the current position, so ViewPager uses F2 directly, but <strong>leave mFragments in adapter not updated</strong>.</li>
<li>After that, it should create F3 by calling instantiateItem on position 2, however, as mFragments still keeping F2 in position 2, it is directly returned and F3 is never created.</li>
<li>In the first swipe after remove, ViewPager tries to display data in position 2 which the fragment F2 is already used in position 1. At the same time, F0 is removed from FragmentManager, F4 is created as item in position 3.</li>
<li>Second swipe, position 3(F4) becomes current item, position 1(F2) removed from FragmentManager, F5 created for position 4.</li>
<li>Third swipe, position 4(F5) becomes current item, ViewPager tried to destroy position 2, but position 2 is also F2, destroying that cause

<blockquote><p>IllegalStateException: Fragment {} is not currently in the FragmentManager.</p></blockquote></li>
</ol>


<h2>Workaround</h2>

<p>When I tried to isolate the problem, I accidentally return POSITION_NONE for all item, and it actually gave the result I want without crash. It worked because all fragments are destroyed in notifyDataSetChanged and re-instantiated, it does the tricks but may cause other performance problem so I am looking for a better solution.</p>

<h2>Possible fix</h2>

<p>I have not start yet, but as mFragments in FragmentStatePagerAdapter is private, extending it and override some methods cannot change it at all. Good news is, you can copy the source and compile it yourself.</p>

<p>To fix this, you need to find a way to update mFragments after checking getItemPosition and destroyItem. My initial thoughts is to handle that in finishUpdate(). The new finishUpdate will become something like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">finishUpdate</span><span class="o">(</span><span class="n">ViewGroup</span> <span class="n">container</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">mCurTransaction</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mCurTransaction</span><span class="o">.</span><span class="na">commitAllowingStateLoss</span><span class="o">();</span>
</span><span class='line'>        <span class="n">mCurTransaction</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="n">mFragmentManager</span><span class="o">.</span><span class="na">executePendingTransactions</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Fragment</span><span class="o">&gt;</span> <span class="n">update</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Fragment</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="o">=</span><span class="n">mFragments</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Fragment</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mFragments</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">f</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">getItemPosition</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
</span><span class='line'>        <span class="k">while</span> <span class="o">(</span><span class="n">update</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">update</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">update</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pos</span><span class="o">,</span> <span class="n">f</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">mFragments</span> <span class="o">=</span> <span class="n">update</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>One problem is that finishUpdate is also called in other places so need to make sure this change will not break other code and not causing performance issue.</p>

<h2>About this post&hellip;</h2>

<p>At first I just want to write a short notes on the problem I met during work, then I tried to isolate the problem and reproduce it, tried to find similar posts on stackoverflow, read the soure code to confirm the problem, and even tried to fix it&hellip; This is totally not my plan for this weekend but I actually quite enjoy reading the source code of support library.</p>

<h2>Reference</h2>

<ul>
<li><a href="https://plus.google.com/u/0/105980838674582844427/posts/a1xwgEEehCs">Discussion on gplus</a> thx Adam Powell for replying my post.</li>
<li>Source of <a href="https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v4/java/android/support/v4/view/ViewPager.java">ViewPager</a> and <a href="https://android.googlesource.com/platform/frameworks/support/+/refs/heads/master/v4/java/android/support/v4/app/FragmentStatePagerAdapter.java">FragmentStatePagerAdapter</a></li>
<li><a href="https://code.google.com/p/android/issues/detail?id=37990">https://code.google.com/p/android/issues/detail?id=37990</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Useful features I missed during Android development]]></title>
    <link href="http://billynyh.github.io//blog/2014/02/23/features-missed-during-development/"/>
    <updated>2014-02-23T19:36:59+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/02/23/features-missed-during-development</id>
    <content type="html"><![CDATA[<p>This weekend, I am working on my Muzei extension and try to add a setting page to it. It is not hard to write everything myself, but I was not in the mood of writing code from scratch, so I just copy code from <a href="https://github.com/flavienlaurent/muzeihash">other opensource project</a>. Modifying other&rsquo;s code does not always speed up your development when your task is so simple, but you can take this chance to read other&rsquo;s code at the same time.</p>

<p>I don&rsquo;t consider myself learned Android development correctly, but I guess most people started like me. I started with a small project, lookup the doc for the features I need, then learn other features while doing other projects.When you learn like this, it is easy to miss out simple features. Here are what I found this week:</p>

<h2>Show divider in LinearLayout</h2>

<p>Can&rsquo;t believe I missed this, there was a couple times that I need to append dummy view to act as divider. The worst thing about adding divider view yourself is not the extra code you added, is when you try to control visiblity of elements, you need to handle the dividers also.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">LinearLayout</span> <span class="nl">xmlns:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">orientation</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">showDividers</span><span class="o">=</span><span class="s">&quot;middle&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">divider</span><span class="o">=</span><span class="s">&quot;?android:dividerVertical&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">dividerPadding</span><span class="o">=</span><span class="s">&quot;4dp&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>CheckedTextView</h2>

<p>The first time when I want to have checkbox put on the right side of the text, I went through the available options of CheckBox class and cannot find any good, then I go to google and stackoverflow, <a href="http://stackoverflow.com/questions/5000213/how-to-set-the-checkbox-on-the-right-side-of-the-text">first solution</a> is to put a TextView to the left of CheckBox. Usually I will just stop here and start coding, but it is obviously not good enoguh, as now you can only trigger it by clicking the checkbox but not the whole text+checkbox.</p>

<p>If you tried the multiple choice feature of ListView, you will see it is exactly the behavior you look for, a little <a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/res/res/layout/simple_list_item_multiple_choice.xml">dig in</a> will give you CheckedTextView.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">CheckedTextView</span> <span class="nl">xmlns:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@android:id/text1&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;?android:attr/listPreferredItemHeightSmall&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">textAppearance</span><span class="o">=</span><span class="s">&quot;?android:attr/textAppearanceListItemSmall&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">gravity</span><span class="o">=</span><span class="s">&quot;center_vertical&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">checkMark</span><span class="o">=</span><span class="s">&quot;?android:attr/listChoiceIndicatorMultiple&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">paddingStart</span><span class="o">=</span><span class="s">&quot;?android:attr/listPreferredItemPaddingStart&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">paddingEnd</span><span class="o">=</span><span class="s">&quot;?android:attr/listPreferredItemPaddingEnd&quot;</span>
</span><span class='line'><span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can even extend other layout with <a href="http://developer.android.com/reference/android/widget/Checkable.html">Checkable</a> interface, more detail <a href="http://chris.banes.me/2013/03/22/checkable-views/">here</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[First play on Muzei]]></title>
    <link href="http://billynyh.github.io//blog/2014/02/16/first-play-on-muzei/"/>
    <updated>2014-02-16T23:05:43+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/02/16/first-play-on-muzei</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/romannurik/muzei">Muzei live wallpaper</a> is a new opensource project from Roman Nurik which provide a nice API for other developers to build extension on it easily. Just a few days after its release on Feb 12, you can already find quite many different <a href="https://play.google.com/store/search?q=muzei&amp;c=apps">data source</a> for it. So I played for a while today and found that it is&hellip; really easy to implement your own data source.</p>

<p>Here is a quick start on creating the extension.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyArtSource</span> <span class="kd">extends</span> <span class="n">RemoteMuzeiArtSource</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">UPDATE_INTERVAL</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">;</span> <span class="c1">// 60min</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MyArtSource</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="s">&quot;my-art-source&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
</span><span class='line'>        <span class="n">setUserCommands</span><span class="o">(</span><span class="n">BUILTIN_COMMAND_ID_NEXT_ARTWORK</span><span class="o">);</span> <span class="c1">// manual switch image</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onTryUpdate</span><span class="o">(</span><span class="kt">int</span> <span class="n">reason</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RetryException</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// fetch title, imageUrl, id, url from remote or hardcode</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">publishArtwork</span><span class="o">(</span><span class="k">new</span> <span class="n">Artwork</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span><span class='line'>            <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">title</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">imageUri</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">imageUrl</span><span class="o">))</span>
</span><span class='line'>            <span class="o">.</span><span class="na">token</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">viewIntent</span><span class="o">(</span><span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_VIEW</span><span class="o">,</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">url</span><span class="o">)))</span>
</span><span class='line'>            <span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">scheduleUpdate</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="n">UPDATE_INTERVAL</span><span class="o">);</span> <span class="c1">// switch image after 60min</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can find my Muzei 9GAG extension on <a href="https://play.google.com/store/apps/details?id=com.billynyh.muzei9gag">Play store</a>, source code available on <a href="https://github.com/billynyh/android-muzei-9gag">Github</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Implementing zoomable view - part 1]]></title>
    <link href="http://billynyh.github.io//blog/2014/02/15/implmenting-view-gesture-1/"/>
    <updated>2014-02-15T22:27:54+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/02/15/implmenting-view-gesture-1</id>
    <content type="html"><![CDATA[<p>Last year I implemented a custom view that supports different gestures including zoom(scale), scroll, double tap. As a newbie on custom view, the whole measuring and drawing already spent me some time, so the gesture control turned out enough to use but was actually incomplete and not finished.</p>

<p>Recently, I have a task to embed my custom view to ViewPager and other custom ViewGroup that intercept touch events. As expected, my custom view takes all the touch events so the ViewPager cannot perform horizontal swipe. I woule like to take this chance to review my gesture handling and hopefully can make it work.</p>

<p>What I did last year is mostly referencing Chris Banes&rsquo;s <a href="https://github.com/chrisbanes/PhotoView/blob/master/library/src/uk/co/senab/photoview/PhotoViewAttacher.java">PhotoView library</a>. The basic idea is:</p>

<ul>
<li>create a &ldquo;view attacher&rdquo; that implements a View.OnTouchListener</li>
<li>create instance of <a href="http://developer.android.com/reference/android/view/ScaleGestureDetector.html">ScaleGesutreDetector</a> and <a href="http://developer.android.com/reference/android/view/GestureDetector.html">GestureDetector</a>, notice that <a href="https://github.com/chrisbanes/PhotoView/blob/master/library/src/uk/co/senab/photoview/gestures/GestureDetector.java">PhotoView&rsquo;s GestureDetector</a> is not the one in Android framework</li>
<li>use those detectors in OnTouchListener&rsquo;s onTouch method</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ZoomableViewAttacher</span> <span class="kd">implements</span> <span class="n">View</span><span class="o">.</span><span class="na">OnTouchListener</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">GestureDetector</span> <span class="n">mGestureDetector</span><span class="o">;</span>
</span><span class='line'>    <span class="n">ScaleGestureDetector</span> <span class="n">mScaleGestureDetector</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">onTouch</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="n">MotionEvent</span> <span class="n">ev</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">boolean</span> <span class="n">handled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">mGestureDetector</span> <span class="o">&amp;&amp;</span> <span class="n">mGestureDetector</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">handled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">mScaleGestureDetector</span> <span class="o">&amp;&amp;</span> <span class="n">mScaleGestureDetector</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">ev</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">handled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">handled</span><span class="o">;</span> <span class="c1">// or just return true;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So far this worked for me last year as I am using the view alone, I did not have to consider the case that the view&rsquo;s parent intercepted the touch event.</p>

<p>Now the problem is, how do I prevent the ViewPager intercepting my touch event? After digging deeper, I found a requestDisallowInterceptTouchEvent method in ViewParent. According to the framework <a href="http://developer.android.com/reference/android/view/ViewParent.html#requestDisallowInterceptTouchEvent(boolean)">doc</a></p>

<blockquote><p>Called when a child does not want this parent and its ancestors to intercept touch events with onInterceptTouchEvent(MotionEvent).</p><p>This parent should pass this call onto its parents. This parent must obey this request for the duration of the touch (that is, only clear the flag after this parent has received an up or a cancel.</p></blockquote>


<p>Which means, if I call the method in correct time, I should be able to enable and disable ViewPager&rsquo;s onInterceptTouchEvent. Googled a little bit on requestDisallowInterceptTouchEvent, found some example on StackOverflow like</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">:</span>
</span><span class='line'>        <span class="n">parent</span><span class="o">.</span><span class="na">requestDisallowInterceptTouchEvent</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_CANCEL</span><span class="o">:</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">:</span>
</span><span class='line'>        <span class="n">parent</span><span class="o">.</span><span class="na">requestDisallowInterceptTouchEvent</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="k">default</span><span class="o">:</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is obviously not enough for me, since it disabled the parent for the whole touch motion, if I touch on my custom and actually want to perform a page swipe on ViewPager, thie code will definitely break the ViewPager usage.</p>

<p>My first attempt is something like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">:</span>
</span><span class='line'>        <span class="n">parent</span><span class="o">.</span><span class="na">requestDisallowInterceptTouchEvent</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_CANCEL</span><span class="o">:</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">:</span>
</span><span class='line'>        <span class="n">parent</span><span class="o">.</span><span class="na">requestDisallowInterceptTouchEvent</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="k">default</span><span class="o">:</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(!</span><span class="n">canScroll</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// re-enable parents&#39; onInterceptTouchEvent</span>
</span><span class='line'>        <span class="n">parent</span><span class="o">.</span><span class="na">requestDisallowInterceptTouchEvent</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>It would be great if GestureDetector can directly give me the information needed for my canScroll() method. However, it seems that GestureDetector need a few events to determine if it is a scroll, there is a gap of 3-5 events between my first ACTION_DOWN and onScoll callback, so I need a better way to determine the condition for calling parent.requestDisallowInterceptTouchEvent().</p>

<p>In part 2, I will continue with the implementation of canScroll() method.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android development resources collections]]></title>
    <link href="http://billynyh.github.io//blog/2014/01/18/collections/"/>
    <updated>2014-01-18T23:48:54+08:00</updated>
    <id>http://billynyh.github.io//blog/2014/01/18/collections</id>
    <content type="html"><![CDATA[<h3>Recently read</h3>

<ul>
<li>GTAC 2013 <a href="https://developers.google.com/google-test-automation-conference/2013/presentations">presentations</a> * <a href="http://www.youtube.com/watch?v=HUE_yrd8tl0">How Facebook Tests Facebook on Android</a>

<ul>
<li><a href="http://goo.gl/278b4">Slides</a></li>
</ul>
</li>
</ul>


<div class="video-container">
<iframe src="http://www.youtube.com/embed/HUE_yrd8tl0" frameborder="0" allowfullscreen></iframe>
</div>


<p></p>

<ul>
<li>Facebook: <a href="https://code.facebook.com/mobile/">mobile engi blog</a>, <a href="https://github.com/facebook">github</a>

<ul>
<li><a href="https://code.facebook.com/posts/454616284650560/building-a-faster-messenger/">Building a faster Messenger</a>

<blockquote><p>Michael Marucheck, had the idea to actually edit the Java byte code after compilation. We used ASM to improve our dependency injection system by detecting bindings that are safe to remove, adding static methods that instantiate a bound type, and rewriting calls to the injector to instead call the appropriate static method. By improving this process, we were able to have a well-crafted dependency injection system that lets us test at scale, but still with the 30% gain in speed.</p></blockquote></li>
</ul>
</li>
</ul>


<h3>Other</h3>

<ul>
<li>Twitter: <a href="https://www.youtube.com/user/TwitterUniversity/videos">youtube</a></li>
<li>Square: <a href="http://corner.squareup.com/">engi blog</a>, <a href="https://github.com/square">github</a></li>
<li>Etsy: <a href="http://codeascraft.com/category/mobile/">blog &ndash; mobile</a>, <a href="https://github.com/etsy">github</a></li>
<li>Pocket: <a href="http://getpocket.com/blog/category/development/">blog &ndash; dev</a></li>
<li>Feedly: <a href="http://blog.feedly.com/">blog</a></li>
<li>Romain Guy: <a href="http://www.curious-creature.org/category/android/">blog</a>, <a href="https://speakerdeck.com/romainguy">speaker deck</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My 2013 Android development]]></title>
    <link href="http://billynyh.github.io//blog/2013/12/23/my-2013-development/"/>
    <updated>2013-12-23T23:48:54+08:00</updated>
    <id>http://billynyh.github.io//blog/2013/12/23/my-2013-development</id>
    <content type="html"><![CDATA[<p>2013 was a fresh start for me. I joined a new team, started the Android product from scratch, get a nice number of active users and keep it growing. During my development, I referenced many opensource projects and learnt alot from them.</p>

<h3><a href="https://github.com/kevinsawicki/http-request">kevinsawicki/http-request</a></h3>

<p>This is the very first library I added to my project (support-v4 does not count). This library provided a nice wrap of http call. I am not sure if this can be used with other network library like square/okhttp and android/volley, hope I have time to try it out in 2014.</p>

<h3><a href="https://github.com/jfeinstein10/SlidingMenu">jfeinstein10/SlidingMenu</a></h3>

<p>This is the sliding menu I used at the beginning, I like the effect very much. Although I switched to Android DrawerLayout after it was introduced in support-v4, I do like the old SlidingMenu more. Personally I like to have the drawer push the content out, DrawerLayout is more like an overlay, they both make sense to me, let see will the design guideline include this kind of UI also.</p>

<h3><a href="https://github.com/square/otto">square/otto</a></h3>

<p>I am a big fan of Square opensource projects but I was not using any event bus so when I saw otto I did not get it at first. When things getting complicated that you cannot write everything in your Activity/Fragment, you will try to split the logic to different components. The old school way to communicate between components is implements some kind of listener, it works for a while, a short while&hellip; The app goes complicated way faster than I expect, so I decided to make a big structure change by using an event bus system. I have not compared other event bus library but otto works for me perfectly.</p>

<h3>ActionBar</h3>

<p>Before the official actionbar-compact was released after GoogleIO, I think most people will use ActionBarSherlock. However, I implmented my own. I think it gives me more flexibility if you implemented your own, especially when you dont need those inflate from menu support. The down side is you lost support from all opensource projects, I have to implement my own refresh/progress buttons, ShareActionProvider, cannot play with those fancy fading actionbar, not boring actionbar library, may even need to write my own android style pull to refresh. Those disadvantage are usually enough to stop me from using my own implementation, but I decided to keep it. Mostly because it turns out not that hard to migrate to my own actionbar as long as it is opensourced and I do not have to worry about two libraries not working together (because I am not using any&hellip;).</p>
]]></content>
  </entry>
  
</feed>
